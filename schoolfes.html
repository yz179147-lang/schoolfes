<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ ¡æ…¶å¤§ä½œæˆ°ï¼šé¬¼å±‹ä¼åŠƒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* é»‘æ¿ç²‰ç­†é…è‰² */
            --board-bg: #2b3a42; /* æ·±ç¶ é»‘æ¿è‰² */
            --board-border: #8d6e63; /* æœ¨æ¡†è‰² */
            --chalk-white: #fcfcfc;
            --chalk-yellow: #fff59d;
            --chalk-pink: #ffccbc;
            --chalk-blue: #b3e5fc;
            --chalk-green: #c8e6c9;
            --eraser-dust: rgba(255,255,255,0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Patrick Hand', 'Noto Sans TC', sans-serif; /* æ‰‹å¯«å­—é«”æ„Ÿ */
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23cccccc' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            overscroll-behavior: none; 
        }

        .blackboard {
            background-color: var(--board-bg);
            border: 12px solid var(--board-border);
            border-radius: 8px;
            width: 100%;
            max-width: 950px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3), inset 0 0 40px rgba(0,0,0,0.5);
            padding: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 95vh;
            overflow-y: auto;
            color: var(--chalk-white);
        }

        /* ç²‰ç­†ç°è³ªæ„Ÿ */
        .blackboard::before {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        /* è£é£¾ï¼šæ¿æ“¦èˆ‡ç²‰ç­† */
        .blackboard::after {
            content: ' '; 
            position: absolute; bottom: 10px; right: 20px;
            width: 80px; height: 30px;
            background: repeating-linear-gradient(45deg, #d7ccc8, #d7ccc8 5px, #8d6e63 5px, #8d6e63 10px);
            border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
            z-index: 10;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px dashed rgba(255,255,255,0.3);
            padding-bottom: 15px;
            margin-bottom: 20px;
            z-index: 1;
        }

        h2 { 
            margin: 0; font-size: 2.2rem; 
            color: var(--chalk-yellow);
            font-weight: normal;
            letter-spacing: 2px;
            transform: rotate(-1deg);
        }

        .class-info {
            text-align: right;
            font-size: 1.2rem;
            color: var(--chalk-blue);
        }

        /* æ•…äº‹å€åŸŸ */
        .chalk-box {
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px; /* æ‰‹ç¹ªæ¡†ç·šæ•ˆæœ */
            padding: 20px;
            margin-bottom: 25px;
            font-size: 1.4rem;
            line-height: 1.6;
            z-index: 1;
        }

        /* Visual Area */
        .visual-area {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 250px;
            margin-bottom: 25px;
            z-index: 1;
        }

        /* Drawing Components */
        /* Table */
        .chalk-table {
            width: 100%; border-collapse: collapse; font-size: 1.3rem;
        }
        .chalk-table th, .chalk-table td {
            border: 2px solid var(--chalk-white);
            padding: 12px; text-align: center;
        }
        .chalk-table th { color: var(--chalk-pink); }
        
        /* Classroom Grid */
        .floor-plan {
            display: grid;
            grid-template-columns: repeat(8, 40px); /* 8åˆ— */
            gap: 2px;
            padding: 10px;
            border: 3px solid var(--chalk-white);
        }
        .tile {
            width: 40px; height: 40px;
            border: 1px dashed rgba(255,255,255,0.3);
            display: flex; justify-content: center; align-items: center;
            font-size: 1.2rem;
        }
        .tile.desk { background: rgba(141, 110, 99, 0.4); } /* æ¡Œæ¤…å€ */
        .tile.ghost { background: rgba(179, 229, 252, 0.3); color: var(--chalk-blue); } /* é¬¼å±‹å€ */
        .tile.door { border: 2px solid var(--chalk-yellow); color: var(--chalk-yellow); font-weight: bold; }

        /* Door Angle Visual */
        .door-visual {
            width: 200px; height: 200px; position: relative;
        }
        .wall {
            position: absolute; left: 100px; top: 0; bottom: 0; width: 4px; background: var(--chalk-white);
        }
        .door-frame {
            position: absolute; top: 100px; left: 100px; width: 80px; height: 6px;
            background: var(--chalk-yellow); transform-origin: left center;
            transition: transform 1s;
        }
        .angle-arc {
            position: absolute; top: 70px; left: 70px; width: 60px; height: 60px;
            border: 2px dotted var(--chalk-pink); border-radius: 50%;
            clip-path: polygon(50% 50%, 100% 0, 100% 100%);
        }

        /* Inputs */
        .input-group { display: flex; gap: 15px; z-index: 1; margin-top: 20px; }
        
        input[type="number"] {
            flex: 1; padding: 15px; border: none; border-bottom: 3px solid var(--chalk-white);
            background: transparent; color: var(--chalk-white);
            font-size: 1.8rem; text-align: center; font-family: 'Patrick Hand', sans-serif;
            outline: none;
        }
        input::placeholder { color: rgba(255,255,255,0.3); }

        button {
            padding: 10px 30px; border: 2px solid var(--chalk-white);
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            background: transparent; color: var(--chalk-white);
            font-size: 1.4rem; cursor: pointer; font-family: 'Patrick Hand', sans-serif;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
        
        .btn-main { border-color: var(--chalk-yellow); color: var(--chalk-yellow); font-weight: bold; }
        .btn-opt { flex: 1; margin: 0 5px; }
        .btn-opt.selected { background: var(--chalk-white); color: var(--board-bg); }

        /* Feedback */
        .stamp {
            margin-top: 20px; padding: 15px; 
            border: 3px solid; border-radius: 10px;
            text-align: center; font-size: 1.5rem; transform: rotate(-2deg);
            display: none; animation: stampIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 5;
        }
        .stamp.correct { border-color: var(--chalk-green); color: var(--chalk-green); border-style: double; }
        .stamp.wrong { border-color: var(--chalk-pink); color: var(--chalk-pink); border-style: dashed; }

        @keyframes stampIn { from { transform: scale(1.5) rotate(10deg); opacity: 0; } to { transform: scale(1) rotate(-2deg); opacity: 1; } }

        .hidden { display: none !important; }

        /* Progress - Chalk line style */
        .progress-line {
            width: 100%; height: 4px; background: rgba(255,255,255,0.2);
            margin-top: 10px; position: relative;
        }
        .progress-chalk {
            height: 100%; background: var(--chalk-yellow); width: 0%;
            box-shadow: 0 0 5px var(--chalk-yellow); transition: width 0.5s;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .floor-plan { grid-template-columns: repeat(8, 30px); }
            .tile { width: 30px; height: 30px; font-size: 0.9rem; }
            .input-group { flex-direction: column; }
        }
    </style>
</head>
<body>

<div class="blackboard">
    <div class="header">
        <h2>ğŸ‘» æ ¡æ…¶é¬¼å±‹ä¼åŠƒ</h2>
        <div class="class-info">
            ä¸‰å¹´äºŒç­<br>
            <div class="progress-line"><div class="progress-chalk" id="progress-bar"></div></div>
        </div>
    </div>

    <div id="intro-screen">
        <div class="chalk-box">
            <span style="color:var(--chalk-yellow)">å—¨ï¼Œç¸½å¬ï¼</span><br><br>
            æ ¡æ…¶åœ’éŠæœƒè¦åˆ°äº†ï¼Œæˆ‘å€‘ç­æ±ºå®šè¦åšã€Œææ€–æ•™å®¤ã€ï¼<br>
            ä½†æ˜¯ï¼Œè¨“å°ä¸»ä»»èªªï¼šã€Œä¼åŠƒæ›¸è¦ç®—å¾—æ¸…æ¸…æ¥šæ¥šæ‰èƒ½é€šéã€‚ã€<br><br>
            ä½ éœ€è¦å¹«å¿™è¨ˆç®—ï¼š<br>
            1. ğŸŸï¸ <strong>åœ˜é«”ç¥¨çš„æ”¶å…¥</strong> (ä¹˜æ³•)<br>
            2. ğŸ“ <strong>åš‡äººæ©Ÿé—œçš„è§’åº¦</strong> (è§’åº¦)<br>
            3. ğŸšï¸ <strong>é¬¼å±‹çš„å¸ƒç½®é¢ç©</strong> (é¢ç©)<br><br>
            æ‹¿èµ·ç²‰ç­†ï¼Œæˆ‘å€‘é–‹å§‹è¦åŠƒå§ï¼
        </div>
        <div style="text-align: center; margin-top: 40px;">
            <button class="btn-main" onclick="startGame()" style="font-size: 1.6rem; padding: 15px 50px;">æ‰“é–‹ä¼åŠƒæ›¸ ğŸ“–</button>
        </div>
    </div>

    <div id="game-screen" class="hidden">
        <div class="chalk-box" id="q-text">Loading...</div>
        
        <div class="visual-area" id="q-visual">
            </div>

        <div id="input-number" class="input-group hidden">
            <input type="number" id="user-input" placeholder="åœ¨é€™è£¡å¯«ä¸‹ç­”æ¡ˆ..." inputmode="decimal">
            <button class="btn-main" onclick="submitAnswer()">äº¤å·ï¼</button>
        </div>

        <div id="input-options" class="input-group hidden">
            </div>

        <div class="stamp" id="feedback"></div>

        <div style="margin-top: 30px; display: flex; justify-content: space-between;">
            <button class="btn-opt" style="font-size:1rem; border:1px dashed rgba(255,255,255,0.5);" onclick="showHint()">ğŸ‘€ å·çœ‹å°æŠ„ (æç¤º)</button>
            <button id="btn-next" class="hidden btn-main" onclick="nextLevel()">ä¸‹ä¸€é  â¡ï¸</button>
        </div>
    </div>

    <div id="end-screen" class="hidden" style="text-align: center;">
        <h1 style="color: var(--chalk-yellow); font-size: 3rem;">ä¼åŠƒé€šéï¼ğŸ‰</h1>
        <div class="chalk-box" style="text-align: center;">
            å¤ªæ£’äº†ï¼æ‰€æœ‰çš„è¨ˆç®—éƒ½æ­£ç¢ºã€‚<br>
            è¨“å°ä¸»ä»»è“‹ä¸Šäº†ã€Œé€šéã€çš„å°ç« ã€‚<br>
            ä¸‰å¹´äºŒç­çš„é¬¼å±‹ä¸€å®šæœƒå¤§å—æ­¡è¿ï¼
        </div>
        <div style="margin: 30px 0; font-size: 2rem;">
            ç²å¾—ç­è²»ï¼š <span id="final-score" style="color:var(--chalk-pink); text-decoration: underline;">0</span> å…ƒ
        </div>
        <button class="btn-main" onclick="location.reload()">é‡æ–°è¦åŠƒ</button>
    </div>
</div>

<script>
    const questions = [
        // Level 1: Multiplication (Logic & Money)
        {
            type: "number",
            text: "ã€ç¬¬ä¸€ç« ï¼šé–€ç¥¨å®šåƒ¹ã€‘<br>ç‚ºäº†å¸å¼•æ›´å¤šäººï¼Œæˆ‘å€‘æ¨å‡ºäº†ã€Œå‹‡æ°£åœ˜é«”ç¥¨ã€ï¼<br>ğŸ‘» <strong>å–®äººç¥¨ï¼šæ¯å¼µ 50 å…ƒ</strong><br>ğŸ‘» <strong>åœ˜é«”ç¥¨ (4äººä¸€çµ„)ï¼šæ¯çµ„ 160 å…ƒ</strong><br><br>ç¾åœ¨é–€å£ä¾†äº† <strong>5 çµ„åœ˜é«”</strong> å’Œ <strong>3 ä½æ•£å®¢</strong>ã€‚<br>è«‹å•ï¼šæˆ‘å€‘ç¸½å…±å¯ä»¥æ”¶åˆ°å¤šå°‘éŒ¢ï¼Ÿ",
            visual: `
                <div style="font-size: 3rem; text-align: center;">
                    ğŸ‘¥ğŸ‘¥ğŸ‘¥ğŸ‘¥ğŸ‘¥ <span style="font-size:1rem">(5çµ„)</span><br>
                    ğŸ‘¤ğŸ‘¤ğŸ‘¤ <span style="font-size:1rem">(3äºº)</span>
                </div>
            `,
            answer: 950,
            hint: "åˆ†é–‹ç®—ç®—çœ‹ï¼š\n1. 5 çµ„åœ˜é«”ç¥¨æ˜¯å¤šå°‘éŒ¢ï¼Ÿ (5 x 160)\n2. 3 å¼µå–®äººç¥¨æ˜¯å¤šå°‘éŒ¢ï¼Ÿ (3 x 50)\n3. æœ€å¾ŒåŠ èµ·ä¾†ï¼",
            explanation: "åœ˜é«”ç¥¨æ”¶å…¥ï¼š5 x 160 = 800 å…ƒ<br>å–®äººç¥¨æ”¶å…¥ï¼š3 x 50 = 150 å…ƒ<br>ç¸½æ”¶å…¥ï¼š800 + 150 = 950 å…ƒã€‚<br>è³ºç¿»äº†ï¼"
        },
        // Level 2: Angles (Comparison)
        {
            type: "option",
            options: ["å¸è¡€é¬¼æ£ºæ", "æœ¨ä¹ƒä¼Šæ«ƒå­", "ä¸€æ¨£å¤§"],
            text: "ã€ç¬¬äºŒç« ï¼šåš‡äººæ©Ÿé—œã€‘<br>æˆ‘å€‘è¨­è¨ˆäº†å…©å€‹æ©Ÿé—œï¼Œé–€æ‰“é–‹çš„è§’åº¦ä¸åŒï¼š<br>âš°ï¸ <strong>å¸è¡€é¬¼æ£ºæ</strong>ï¼šé–€æ‰“é–‹æ˜¯ä¸€å€‹ã€Œéˆè§’ã€ã€‚<br>ğŸ¤• <strong>æœ¨ä¹ƒä¼Šæ«ƒå­</strong>ï¼šé–€æ‰“é–‹æ˜¯ä¸€å€‹ã€Œç›´è§’ã€ã€‚<br><br>è«‹å•ï¼šå“ªä¸€å€‹æ©Ÿé—œçš„é–€ã€Œå¼µé–‹å¾—æ¯”è¼ƒå¤§ã€ï¼Ÿ",
            visual: `
                <div style="display:flex; gap:30px; align-items:flex-end;">
                    <div style="text-align:center;">
                        <div style="width:50px; height:50px; border-left:4px solid white; border-bottom:4px solid white; transform: skewX(-20deg);"></div>
                        <small>å¸è¡€é¬¼ (éˆ)</small>
                    </div>
                    <div style="text-align:center;">
                        <div style="width:50px; height:50px; border-left:4px solid white; border-bottom:4px solid white;"></div>
                        <small>æœ¨ä¹ƒä¼Š (ç›´)</small>
                    </div>
                </div>
            `,
            answer: "å¸è¡€é¬¼æ£ºæ",
            hint: "æƒ³æƒ³çœ‹è§’åº¦çš„å¤§å°é—œä¿‚ï¼š\néˆè§’ > ç›´è§’ > éŠ³è§’ã€‚\nèª°æ¯”ç›´è§’(90åº¦)é‚„è¦å¤§ï¼Ÿ",
            explanation: "éˆè§’å¤§æ–¼ 90 åº¦ï¼Œç›´è§’ç­‰æ–¼ 90 åº¦ã€‚<br>æ‰€ä»¥å¸è¡€é¬¼æ£ºæçš„é–€å¼µå¾—æ¯”è¼ƒé–‹ï¼Œæ›´å®¹æ˜“è·³å‡ºä¾†åš‡äººï¼"
        },
        // Level 3: Area (Composite Shape/Subtraction)
        {
            type: "number",
            text: "ã€ç¬¬ä¸‰ç« ï¼šæ•™å®¤ä½ˆç½®ã€‘<br>æˆ‘å€‘çš„æ•™å®¤åŸæœ¬æ˜¯ <strong>8å…¬å°º x 6å…¬å°º</strong> çš„é•·æ–¹å½¢ã€‚<br>ç‚ºäº†å®‰å…¨ï¼Œæˆ‘å€‘åœ¨è§’è½ä¿ç•™äº†ä¸€å¡Š <strong>3å…¬å°º x 3å…¬å°º</strong> çš„ã€Œå®‰å…¨ä¼‘æ¯å€ã€(ä¸ä½ˆç½®)ã€‚<br><br>è«‹å•ï¼šå‰©ä¸‹çš„ã€Œé¬¼å±‹æ¢éšªå€ã€é¢ç©æ˜¯å¤šå°‘å¹³æ–¹å…¬å°ºï¼Ÿ",
            visual: `
                <div class="floor-plan">
                    <div class="tile ghost" style="grid-column: span 8; grid-row: span 3;">é¬¼å±‹å€</div>
                    <div class="tile ghost" style="grid-column: span 5; grid-row: span 3;">é¬¼å±‹å€</div>
                    <div class="tile desk" style="grid-column: span 3; grid-row: span 3; border:2px solid var(--chalk-green); color:var(--chalk-green);">ä¼‘æ¯å€<br>3x3</div>
                </div>
                <small style="margin-top:5px; color:var(--chalk-blue);">æ•´é–“æ•™å®¤ï¼š8x6</small>
            `,
            answer: 39,
            hint: "æ–¹æ³•ä¸€ï¼šç®—å‡ºæ•´é–“æ•™å®¤é¢ç© (8x6)ï¼Œæ¸›å»ä¼‘æ¯å€é¢ç© (3x3)ã€‚\næ–¹æ³•äºŒï¼šåˆ‡å‰²æˆå…©å€‹é•·æ–¹å½¢ä¾†ç®—ã€‚",
            explanation: "æ•™å®¤ç¸½é¢ç©ï¼š8 x 6 = 48ã€‚<br>ä¼‘æ¯å€é¢ç©ï¼š3 x 3 = 9ã€‚<br>é¬¼å±‹é¢ç©ï¼š48 - 9 = 39 å¹³æ–¹å…¬å°ºã€‚<br>ç©ºé–“å¾ˆå¤§ï¼Œå¯ä»¥æ”¾å¾ˆå¤šé¬¼ï¼"
        }
    ];

    let currentIdx = 0;
    let score = 0;

    // Enter key support
    document.getElementById('user-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') submitAnswer();
    });

    function startGame() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        loadQuestion();
    }

    function loadQuestion() {
        const q = questions[currentIdx];
        
        // Reset UI
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('feedback').className = 'stamp';
        document.getElementById('btn-next').classList.add('hidden');
        document.getElementById('user-input').value = '';
        document.getElementById('user-input').disabled = false;
        
        // Update Progress
        document.getElementById('progress-bar').style.width = `${(currentIdx / questions.length) * 100}%`;
        
        // Render Text & Visual
        document.getElementById('q-text').innerHTML = q.text;
        document.getElementById('q-visual').innerHTML = q.visual;

        // Render Inputs
        const numInput = document.getElementById('input-number');
        const optInput = document.getElementById('input-options');

        if (q.type === 'number') {
            numInput.classList.remove('hidden');
            optInput.classList.add('hidden');
            // document.getElementById('user-input').focus();
        } else {
            numInput.classList.add('hidden');
            optInput.classList.remove('hidden');
            optInput.innerHTML = '';
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-opt';
                btn.innerText = opt;
                btn.onclick = () => checkOption(opt, btn);
                optInput.appendChild(btn);
            });
        }
    }

    function showHint() {
        const q = questions[currentIdx];
        alert("ğŸ” å°æŠ„æç¤ºï¼š\n" + q.hint);
    }

    function submitAnswer() {
        const val = document.getElementById('user-input').value;
        if (!val) return;
        checkResult(parseFloat(val) === questions[currentIdx].answer);
    }

    function checkOption(val, btn) {
        document.querySelectorAll('.btn-opt').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        checkResult(val === questions[currentIdx].answer);
    }

    function checkResult(isCorrect) {
        const fb = document.getElementById('feedback');
        fb.style.display = 'block';

        if (isCorrect) {
            score += 1000; // ç­è²»
            fb.innerHTML = `ğŸ’¯ <strong>ç­”å°äº†ï¼</strong><br>${questions[currentIdx].explanation}`;
            fb.className = 'stamp correct';
            
            // Lock UI
            document.getElementById('user-input').disabled = true;
            document.querySelectorAll('.btn-opt').forEach(b => b.disabled = true);
            document.getElementById('btn-next').classList.remove('hidden');
        } else {
            fb.innerHTML = `âŒ <strong>ç®—éŒ¯å›‰ï¼</strong><br>å†æª¢æŸ¥ä¸€ä¸‹ç®—å¼ï¼Œæˆ–å·çœ‹ä¸€ä¸‹å°æŠ„ã€‚`;
            fb.className = 'stamp wrong';
        }
    }

    function nextLevel() {
        currentIdx++;
        if (currentIdx < questions.length) {
            loadQuestion();
        } else {
            endGame();
        }
    }

    function endGame() {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('end-screen').classList.remove('hidden');
        document.getElementById('progress-bar').style.width = '100%';
        document.getElementById('final-score').innerText = score;
    }
</script>

</body>
</html>